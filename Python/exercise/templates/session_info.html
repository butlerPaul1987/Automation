<!-- Session timeout info for base template -->
<div id="session-info" style="position:fixed;top:10px;right:10px;background:#1a1a1a;border:1px solid #333;border-radius:4px;padding:8px;font-size:.8em;color:#999;z-index:1000;display:none">
    <div>Session expires in: <span id="session-timer">--</span></div>
</div>

<script>
// Token expiration tracking
(function() {
    const accessToken = '{{ session.get("access_token", "") }}';
    if (!accessToken) return;
    
    try {
        // Decode JWT payload (basic decode, not verification)
        const payload = JSON.parse(atob(accessToken.split('.')[1]));
        const expTime = payload.exp * 1000; // Convert to milliseconds
        
        function updateTimer() {
            const now = Date.now();
            const timeLeft = expTime - now;
            
            if (timeLeft <= 0) {
                document.getElementById('session-timer').textContent = 'Expired';
                document.getElementById('session-info').style.background = '#4d1a1a';
                setTimeout(() => {
                    alert('Your session has expired. Please log in again.');
                    window.location.href = '/logout';
                }, 1000);
                return;
            }
            
            const minutes = Math.floor(timeLeft / 60000);
            const seconds = Math.floor((timeLeft % 60000) / 1000);
            document.getElementById('session-timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Show warning when less than 5 minutes left
            if (timeLeft < 300000) { // 5 minutes
                document.getElementById('session-info').style.display = 'block';
                document.getElementById('session-info').style.background = '#4d2d1a';
            }
            
            // Show critical warning when less than 1 minute left
            if (timeLeft < 60000) { // 1 minute
                document.getElementById('session-info').style.background = '#4d1a1a';
            }
        }
        
        // Update every second
        setInterval(updateTimer, 1000);
        updateTimer();
        
    } catch (e) {
        console.log('Could not decode token for timer');
    }
})();
</script>